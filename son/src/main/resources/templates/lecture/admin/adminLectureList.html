<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/administrator_layout}"
	layout:fragment="content">
<head>

<title>강의 목록</title>

</head>

<body>
	<div class="row">
		<div class="col-md-12">
			<div class="card">
				<div class="table-responsive pt-3">
					<button type="button" class="btn btn-primary"
						data-bs-toggle="modal" data-bs-target="#lectureRegisterModal">강의
						등록</button>
					<table class="table table-striped project-orders-table">
						<thead>
							<tr>
								<th>강의 번호</th>
								<th>강의 제목</th>
								<th>강의 설명</th>
								<th>강의 비용</th>
								<th>과목</th>
<!-- 								<th>세부 과목</th> -->
								<th>정원</th>
								<th>강의 수준</th>
								<th>요일</th>
								<th>시간</th>
								<th>강의 시작 일자</th>
								<th>강의 종료 일자</th>
								<th>교수자 번호</th>
							</tr>
						</thead>
						<tbody>
							<th:block th:each="lecs : ${adminLecList}">
							    <tr th:data-id="${lecs.lectureNumber}" data-bs-toggle="modal"
							        th:onclick="'lecInfo(\'' + ${lecs.lectureNumber} + '\')'"
							        data-bs-target="#lectureInfoModal">
							        <td th:text="${lecs.lectureNumber}"></td>
							        <td th:text="${lecs.lectureTitle}"></td>
							        <td th:text="${lecs.lectureDescription}"></td>
							        <td th:text="${lecs.lectureCost}"></td>
							        <td th:text="${lecs.subjectCode + '(' + lecs.detailSubjectCode + ')'}"></td>
							        <td th:text="${lecs.capacity}"></td>
							        <td th:text="${lecs.lectureLevelCode}"></td>
							        <td th:text="${lecs.weekdaysCode}"></td>
							        <td th:text="${lecs.timeCode}"></td>
							        <td th:text="${#dates.format(lecs.lectureStartDate, 'yyyy-MM-dd')}"></td>
							        <td th:text="${#dates.format(lecs.lectureEndDate, 'yyyy-MM-dd')}"></td>
							        <td th:text="${lecs.instructorNumber}"></td>
							    </tr>
							</th:block>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

	<!-- 강의 정보 모달 창 -->
	<div class="modal fade" id="lectureInfoModal" tabindex="-1" aria-labelledby="lectureInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="lectureInfoModalLabel">학생 명단 - 강의 번호 :  
                <span id="selectedLectureNumber"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-10">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>학생 번호</th>
                                    <th>이름</th>
                                    <th>이메일</th>
                                    <th>전화번호</th>
                                    <th>생년월일</th>
                                </tr>
                            </thead>
                            <tbody id="lectureStudentList">
                            	 
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-2">
                       <div class="mb-3">
                            <label for="searchName" class="form-label">학생 이메일 검색</label>
                            <input type="text" class="form-control" id="searchEmail" >
                        </div>
                        <button type="button" class="btn btn-secondary" id="searchBtn">검색</button>
                        <div class="mb-3">
                            <label for="searchId" class="form-label">학생 이름 확인</label>
                            <input type="text" class="form-control" id="searchName" readonly>
                        </div>
                        <button type="button" class="btn btn-secondary" id="lecAddBtn">추가</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>

	<!-- 강의 등록 모달 창 -->
	<div class="modal fade" id="lectureRegisterModal" tabindex="-1"
		aria-labelledby="lectureRegisterModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="lectureRegisterModalLabel">강의 등록</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="lectureRegisterForm">
						<!-- 강의 번호 -->
						<div class="mb-3">
							<label for="lectureNumber" class="form-label">강의 번호</label> <input
								type="text" class="form-control" id="lectureNumber"
								name="lectureNumber" required>
						</div>
						<!-- 강의 제목 -->
						<div class="mb-3">
							<label for="lectureTitle" class="form-label">강의 제목</label> <input
								type="text" class="form-control" id="lectureTitle"
								name="lectureTitle" required>
						</div>

						<!-- 강의 내용 -->
						<div class="mb-3">
							<label for="lectureDescription" class="form-label">강의 설명</label>
							<textarea class="form-control" id="lectureDescription"
								name="lectureDescription" required></textarea>
						</div>
						<!-- 과목 코드 -->
						<div class="mb-3">
							<label for="subjectCode" class="form-label">과목 코드</label> 
							<select	class="form-select" id="subjectCode" name="subjectCode" required></select>
							
						</div>
						<!-- 세부 과목 코드 -->
						<div class="mb-3">
							<label for="detailSubjectCode" class="form-label">세부 과목
								코드</label> <select class="form-select" id="detailSubjectCode"
								name="detailSubjectCode" required></select>
						</div>
						<!-- 강의 레벨 코드 -->
						<div class="mb-3">
							<label for="lectureLevelCode" class="form-label">강의 레벨 코드</label>
							<select class="form-select" id="lectureLevelCode"
								name="lectureLevelCode" required>
								<option value="">강의 레벨 코드를 선택하세요</option>
								<option value="심화반">심화반</option>
								<option value="기본반">기본반</option>
							</select>
						</div>
						<!-- 요일 코드 -->
						<div class="mb-3">
							<label class="form-label">요일 코드</label><br>
							<div id="weekdaysCode"></div>
						</div>
						<!-- 시간 코드 -->
						<div class="mb-3">
							<label for="timeCode" class="form-label">시간 코드</label> <select
								class="form-select" id="timeCode" name="timeCode" required></select>
						</div>
						<!-- 강의 비용 -->
						<div class="mb-3">
							<label for="lectureCost" class="form-label">강의 비용</label> <input
								type="text" class="form-control" id="lectureCost"
								name="lectureCost" required>
						</div>
						<!-- 수용 인원 -->
						<div class="mb-3">
							<label for="capacity" class="form-label">수용 인원</label> <input
								type="text" class="form-control" id="capacity" name="capacity"
								required>
						</div>
						<!-- 강의 시작 날짜 -->
						<div class="mb-3">
							<label for="lectureStartDate" class="form-label">강의 시작 날짜</label>
							<input type="date" class="form-control" id="lectureStartDate"
								name="lectureStartDate" required>
						</div>
						<!-- 강의 종료 날짜 -->
						<div class="mb-3">
							<label for="lectureEndDate" class="form-label">강의 종료 날짜</label> <input
								type="date" class="form-control" id="lectureEndDate"
								name="lectureEndDate" required>
						</div>
						<!-- 강사 번호 -->
						<div class="mb-3">
							<label for="instructorNumber" class="form-label">강사 번호</label> <input
								type="text" class="form-control" id="instructorNumber"
								name="instructorNumber" required>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">닫기</button>
					<button type="submit" class="btn btn-primary" id="insertLecBtn"
						form="lectureRegisterForm">등록</button>
				</div>
			</div>
		</div>
	</div>




</body>

<script th:inline="javascript">

	



// 	function infoClick(lectureNumber) {
// 	    console.log(lectureNumber);
	    
// 	    $.ajax({
// 	    	type : 'GET',
// 	    	url : 'adminLectureInfo',
// 	    	data : {lectureNumber : lectureNumber},
// 	    	success :function(response){
// 			    console.log(lectureNumber);
// 			    Object.keys(response).forEach((key, idx) => {
// 					if (document.getElementById(key)){
// 					document.getElementById(key).innerText = response[key];
// 					}
// 				});
// 	    	},
// 			error : function(xhr, status, error) {
// 				console.error('Error fetching member info:', error);
// 			}
	    	
	    	
// 	    })
// 	}


	//======================================================================
	// 학생 검색 하기
	//======================================================================

	let stuInsInfo = {};
	
	
	document.getElementById('searchBtn').addEventListener('click', function() {
	    const searchEmail = document.getElementById('searchEmail').value;
	
	    $.ajax({
	        type: 'GET',
	        url: 'adminLectureStudentSearch',  
	        data: {
	            email: searchEmail
	        },
	        success: function(response) {
	            console.log('서버 응답:', response.name);
	            const name = document.getElementById('searchName');
	            
	            console.log('최종 응답' , lectureNumber)
	            stuInsInfo = response
// 	            stuInsInfo.lecture_number = lecNum;
	            name.value = response.name;
// 	            console.log('최종 응답' , stuInsInfo)
	        },
	        error: function(xhr, status, error) {
	            console.error('서버 요청 실패:', error);
	        }
	    });
	});
		
	
	//======================================================================
	// 학생 추가하기
	//======================================================================
	document.getElementById('lecAddBtn').addEventListener('click', function() {
	    const searchEmail = document.getElementById('searchEmail').value;
	
	    $.ajax({
	        type: 'POST',
	        url: 'adminLectureStudentInsert',  
	        data: JSON.stringify(stuInsInfo),
            contentType: 'application/json; charset=utf-8',
	        success: function(response) {
	            console.log('추가할 학생:', response);
	        },
	        error: function(xhr, status, error) {
	            console.error('서버 요청 실패:', error);
	        }
	    });
	});
		
	//======================================================================
	// 강의 별 학생 리스트 불러오기
	//======================================================================
	
	let lecStuList = [];
	
	
	function lecInfo(lectureNumber) {
		$.ajax({
	    	type : 'GET',
	    	url : 'adminLectureStudentList',
	    	data : {lectureNumber : lectureNumber},
	    	success :function(lecStuResponse){
			    console.log(lecStuResponse , '결과');
			    lecStuList = lecStuResponse;
				const lecStLi = document.getElementById('lectureStudentList');
				console.log('결과', lecStuList);
				let tableHTML = '';
				lecStuList.forEach(student => {
				  tableHTML += '<tr>';
				  tableHTML += `<td>${student.studentNumber}</td>`;
				  tableHTML += `<td>${student.name}</td>`;
				  tableHTML += `<td>${student.email}</td>`;
				  tableHTML += `<td>${student.phone}</td>`;
				  tableHTML += `<td>${student.birth}</td>`;
				  tableHTML += '</tr>';
				});

				lecStLi.innerHTML = tableHTML;
			    document.getElementById('selectedLectureNumber').textContent = lectureNumber;

				 function lecInfo(lectureNumber) {
			         // lectureNumber를 객체에 추가
			         lecStuList.lectureNumber = lectureNumber;
			         
			         // lectureNumber를 selectedLectureNumber 스팬 요소에 추가
			         document.getElementById('selectedLectureNumber').textContent = lectureNumber;
			     }
	    	},
			error : function(xhr, status, error) {
				console.error('Error fetching member info:', error);
			}
	    })
	}
	console.log(lecStuList, '결과2');
	


	
	//======================================================================
	// 등록 버튼 생성
	//======================================================================
	const subList = /*[[${lecSublist}]]*/[];
    const subDeList = /*[[${lecSubDeList}]]*/[];
    let selectedValue = "";

   			console.log(subDeList[0]);
   			console.log(subDeList[0].subjectCode);


   			
   			
            // 과목 코드
            // 과목 코드
			if (subjectCode) {
			    const subjectCodeCell = document.getElementById('subjectCode');
			    const detailSubjectCodeCell = document.getElementById('detailSubjectCode');
			    subjectCodeCell.innerHTML = ''; // 기존의 내용 초기화
			
			    subList.forEach(subject => {
			        const option = document.createElement('option');
			        option.text = subject.subjectName;
			        option.value = subject.subjectCode;
			        subjectCodeCell.appendChild(option); // 과목 코드 select에 option 추가
			    });
			
			    subjectCodeCell.addEventListener('change', function() {
			        const selectedValue = subjectCodeCell.value; // 선택된 과목 코드 값 가져오기
			
			        // 세부 과목 코드 select 초기화
			        detailSubjectCodeCell.innerHTML = '';
			
			        // 선택된 과목 코드에 해당하는 세부 과목 코드 option 추가
			        subDeList.forEach(subDetail => {
			            if (selectedValue === subDetail.subjectCode) {
			                const option = document.createElement('option');
			                option.text = subDetail.detailSubjectName;
			                option.value = subDetail.detailSubjectCode;
			                detailSubjectCodeCell.appendChild(option);
			            }
			        });
			    });
			}

			



            // 강의 레벨 코드
//             const lectureLevelCodeCell = document.getElementById('lectureLevelCode');
//             if (lectureLevelCodeCell) {
//                 const select = document.createElement('select');
//                 const option1 = document.createElement('option');
//                 option1.text = '심화반';
//                 select.add(option1);
//                 lectureLevelCodeCell.innerHTML = '';
//                 lectureLevelCodeCell.appendChild(select);
//             }

           	let days = ['월요일','화요일','수요일', '목요일', '금요일'];
            // 강의 요일 코드
            const weekdaysCodeCell = document.getElementById('weekdaysCode');
            weekdaysCodeCell.innerHTML = '';
           	days.forEach(day =>{
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.value = day;

                const label = document.createElement('label');
                label.innerText = day;

                weekdaysCodeCell.appendChild(label);
                weekdaysCodeCell.appendChild(input);
           	})
           	console.log("days : ",days);
           	

            // 강의 시간 코드
		    const timeCodeSelect = document.getElementById('timeCode');
		    
		    if (timeCodeSelect) {
		        timeCodeSelect.innerHTML = '';
		        
		        for (let i = 15; i <= 22; i++) {
		            const option = document.createElement('option');
		            option.value = `${i},${i + 1}`;
		            option.textContent = `${i}~${i + 1}`;
		            timeCodeSelect.appendChild(option);
		        }
		    }
			
		    
		    const insertLecBtn = document.getElementById('insertLecBtn');
		    insertLecBtn.addEventListener('click', function(event){
		        event.preventDefault(); // 기본 폼 제출 동작 방지

		        // 입력 필드 값 가져오기
		        const lectureNumber = document.getElementById('lectureNumber').value;
		        const lectureTitle = document.getElementById('lectureTitle').value;
		        const lectureDescription = document.getElementById('lectureDescription').value;
		        const subjectCode = document.getElementById('subjectCode').value;
		        const detailSubjectCode = document.getElementById('detailSubjectCode').value;
		        const lectureLevelCode = document.getElementById('lectureLevelCode').value;
		        const timeCode = document.getElementById('timeCode').value;
		        const lectureCost = document.getElementById('lectureCost').value;
		        const capacity = document.getElementById('capacity').value;
		        const lectureStartDate = document.getElementById('lectureStartDate').value;
		        const lectureEndDate = document.getElementById('lectureEndDate').value;
		        const instructorNumber = document.getElementById('instructorNumber').value;
		        
		        // 요일 코드 가져오기 (여러 개일 경우 배열로 저장)
		        const weekdaysCodeElements = document.querySelectorAll('#weekdaysCode input[type="checkbox"]:checked');
				const weekdaysCode = Array.from(weekdaysCodeElements).map(checkbox => checkbox.value).join(',');

		        // 데이터 객체 생성
		        const param = {
		            lectureNumber: lectureNumber,
		            lectureTitle: lectureTitle,
		            lectureDescription: lectureDescription,
		            subjectCode: subjectCode,
		            detailSubjectCode: detailSubjectCode,
		            lectureLevelCode: lectureLevelCode,
		            timeCode: timeCode,
		            lectureCost: lectureCost,
		            capacity: capacity,
		            lectureStartDate: lectureStartDate,
		            lectureEndDate: lectureEndDate,
		            instructorNumber: instructorNumber,
		            weekdaysCode: weekdaysCode
		        };

		        console.log(param);

		        // AJAX 요청
		        $.ajax({
		            type: 'post',
		            url: 'adminLectureInsert', 
		            data: JSON.stringify(param),
		            contentType: 'application/json; charset=utf-8',
		            dataType: 'json', 
		            success: function(result){
		                console.log('서버 응답:', result);
		                // 성공 시 모달 창 닫기 또는 추가 작업 수행
		                $('#lectureRegisterModal').modal('hide');
		                // 폼 초기화
		                document.getElementById('lectureRegisterForm').reset();
		            },
		            error: function(){
		                console.error('서버 요청 실패');
		            }
		        });
		    });

        

	//======================================================================
	// 수정폼으로 변경 버튼
	//======================================================================

	function updateClick(){
		const tableCell = document.querySelectorAll('#lectureInfoTable td');
		
	}
	
	
	

</script>


</html>