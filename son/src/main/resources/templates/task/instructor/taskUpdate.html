<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/instructor_layout}"
	layout:fragment="content">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>과제 수정</title>

<!-- Include ConfigFragment -->
<script src="https://cdn.tailwindcss.com"></script>
<link
	href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
	rel="stylesheet">
<style>
#taskInfoBody {
	font-family: 'Roboto', sans-serif;
}
</style>
</head>

<body id="taskInfoBody">
	<div id="container" style="width: 878px; margin: 0 auto;">
		<form name="updateForm" th:object="${taskInfo}">
			<div
				class="max-w-4xl mx-auto bg-white shadow-md rounded-lg overflow-hidden">
				<div class="grid grid-cols-4 gap-4 p-6 border-b">
					<input type="hidden" th:field="*{taskNumber}" />
					<div class="col-span-1 font-bold">제목</div>
					<div class="col-span-3 border-gray-300">
						<input type="text" class="form-control" th:field="*{title}" />
					</div>
				</div>
				<div class="grid grid-cols-4 gap-4 p-6 border-b">
					<div class="col-span-1 font-bold">게시일자</div>
					<div class="col-span-1  border-gray-300">[[*{#dates.format(postDate,
						'yyyy년 MM월 dd일')}]]</div>
					<div class="col-span-1 font-bold">제출기한</div>
					<div class="col-span-1  border-gray-300">
						<input type="text" class="form-control"
							th:field="*{submitDeadline}" placeholder="yyyy/MM/dd" />
					</div>
				</div>
				<div class="grid grid-cols-4 p-6 border-b">
					<div class="col-span-1 font-bold mb-2">내용</div>
					<div class="col-span-1  border-gray-300">
						<textarea class="form-control" th:field="*{description}"
							style="resize: none; width: 45em; height: 12.25em;"></textarea>
					</div>
				</div>
				<div class="grid grid-cols-4 p-6 border-b">
					<div class="col-span-1 font-bold mb-2">강의번호</div>
					<div class="col-span-1  border-gray-300">
						<input type="number" class="form-control"
							th:field="*{lectureNumber}">
					</div>
				</div>
				<div class="grid grid-cols-4 p-6 border-b" id="file_list">
					<div class="col-span-1 font-bold mb-2">첨부 파일</div>
					<div class="col-span-3 file_input" id="file_input">
						<th:block th:each="files : ${taskInfo.fileList}">
							<div class="file-item d-flex justify-content">
								<input type="text" readonly class="form-control col-8 mb-1"
									th:value="${files.originalFileName}" />
							<div>
								<button type="button"
									class="btn btn-danger btn-sm mt-2">x</button>
								</div>
							</div>
						</th:block>
						<label id="file-field"> <input type="file" name="files"
							multiple class="form-control" onchange="selectFile(this);" />
						</label>
						<button type="button" onclick="removeFile(this);"
							class="btn btn-danger">
							<span>삭제</span>
						</button>
						<button type="button" onclick="addFile();" class="btn btn-info">
							<span>파일 추가</span>
						</button>
					</div>
				</div>
			</div>
			<div class="btn-group float-end" role="group">
				<button type="button" id="updateBtn" class="btn btn-primary mt-3">수정</button>
				<button type="button" class="btn btn-danger mt-3"
					th:onclick="|location.href='@{/instructor/taskInfo(taskNumber=${taskInfo.taskNumber})}'|">취소</button>
			</div>
		</form>
	</div>
	<script>
	/*<![CDATA[*/
	document.getElementById('updateBtn').addEventListener('click', taskUpdateAjax);
    function taskUpdateAjax(event) {

       let info = getTaskInfo();


       $.ajax('taskUpdate', {
           type: 'post',
           contentType: 'application/JSON',
           data: JSON.stringify(info)

       })
       .done(result => {
           console.log(result);
       })
       .fail(err => console.log(err));
    };

    function getTaskInfo() {
       let formData = $('form[name="updateForm"]').serializeArray();
       console.log('1) serializeArray', formData);
       

       let objData = {};
       $.each(formData, (idx, input) =>{
           console.log('2) input', idx, input);
           objData[input.name] = input.value;
       })
       return objData;
    }
	
 // 파일 추가
    function addFile() {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'col-span-3 file_input';
      fileDiv.innerHTML = `
        <input type="text" readonly class="form-control mb-1" />
        <label>
          <input type="file" name="files" class="form-control" onchange="selectFile(this);" />
        </label>
        <button type="button" onclick="removeFile(this);" class="btn btn-danger"><span>삭제</span></button>
      `;
      document.getElementById('file_input').appendChild(fileDiv);
    }

    // 파일 삭제
    function removeFile(element) {
      const fileInput = element.closest('.file_input');
      if (fileInput.parentElement.id === 'file_list') {
        const inputs = fileInput.querySelectorAll('input');
        inputs.forEach(input => input.value = '');
      } else {
        fileInput.remove();
      }
    }
	</script>

	<!-- End custom js for this page-->
</body>

</html>

