<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/administrator_layout}"
	layout:fragment="content">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>PolluxUI Admin</title>

 <!-- FullCalendar Core Stylesheet -->
  <link href='https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.min.css' rel='stylesheet' />

  <!-- FullCalendar DayGrid Plugin Stylesheet -->
  <link href='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.min.css' rel='stylesheet' />

  <!-- FullCalendar TimeGrid Plugin Stylesheet -->
  <link href='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.min.css' rel='stylesheet' />

  <!-- SweetAlert2 Stylesheet -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css" rel="stylesheet" />

<script src="https://unpkg.com/dayjs@1.10.7/dayjs.min.js"></script>



<!-- SweetAlert2 Stylesheet (optional, for styling SweetAlert2 dialogs) -->
<link
	href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
	rel="stylesheet">
<!-- SweetAlert2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Include ConfigFragment -->
<th:block th:replace="common/configs/default_config :: ConfigFragment"></th:block>
<style>
body {
	margin: 40px 10px;
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

.container {
	display: flex;
	align-items: flex-start;
}

#calendar {
	flex: 1;
	max-width: 100%;
}

.table-responsive {
	margin-left: 10%;
}

.schedule-settings {
	text-align: center;
}

.day-time-setting {
	display: flex;
}

.form-select {
	width: 150px;
}
</style>
</head>

<body>
<!-- 	<div class="container"> -->
		<div id="calendar"></div>
<!-- 		<button type="button" class="btn btn-primary" data-bs-toggle="modal" -->
<!-- 			data-bs-target="#weekTime">기본 상담 시간 설정</button> -->
<!-- 		<button type="button" class="btn btn-primary" data-bs-toggle="modal" -->
<!-- 			data-bs-target="#dayTime">상담 일정 조정</button> -->
<!-- 	</div> -->

	<!-- 주간 상담 가능 시간 설정 모달창 -->
	<div class="modal" id="weekTime" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div id="schedule-settings">
						<div class="table-responsive pt-3">
							<h2>상담 시간 조정</h2>
							<div id="counselWeekTime"></div>
						</div>
					</div>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Close</button>
					<button type="button" id="weekBtn" class="btn btn-primary"
						data-bs-dismiss="modal">저장</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 일간 시간별 설정 모달창 -->
	<div class="modal" id="dayTime" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div id="schedule-settings">
						<div class="table-responsive pt-3">
							<h2 id="modalDate"></h2>
							<div id="counselDayTime"></div>
						</div>
					</div>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">...</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">취소</button>
					<button type="button" id="dayBtn" class="btn btn-primary"
						data-bs-dismiss="modal">저장</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script th:inline="javascript">
	
	// 일 - 상담 시간 설정
// 	for (let i = 9; i <= 22; i++) {
// 	    const time = i < 10 ? `0${i}:` : `${i}:`;
// 	    times.push(time);
// 	}
	let currClickedDate = 0;
	
	function schedule(ajax_data){
// 	const dayTimes = [];
// 		days.forEach((day,idx) =>{			
// 			const times = [];
// 			let timeD = ajax_data.split(',');
// 			let fTime = timeD[0];
// 			let sTime = timeD[1];
			
// 			for (let i = fTime; i <= sTime; i++) {
// 			    const time = i < 10 ? `0${i}:` : `${i}:`;
// 			    times.push(time);
// 			}
// 			dayTimes.push(times);
// 		})
// 		console.log(dayTimes);
		
// 		return dayTimes;
// 		let fTime = timeD.substr(0,2);
// 		let sTime = timeD.substr(2,4);
		let arr = [];
		let newData = ajax_data.split(',');
	 	for(let i = newData[0]; i <= newData[1]; i++){
	 		arr.push(i.toString());
	 	}
	 	return arr;
	}
	
    const dayContainer = document.getElementById('counselDayTime');
    
    const dayTimeData = /*[[${counselDayTime}]]*/"";
    
    // 모달 객체 생성
	const counselModal2 = new bootstrap.Modal(document.getElementById('dayTime'));
	console.log('오늘날짜 ', dayTime);
    //모달 실행
    document.addEventListener('DOMContentLoaded', function() {
// 	    console.log('test clg')
// 	     updateDayTimeSetting();
	 });

	function updateDayTimeSetting(unable=[], ajax_data){
		//테이블 요소 생성
		console.log(typeof unable);
		const table = document.createElement('table');
		//테이블 헤더 생성
		const headRow = document.createElement('tr');
		
		//시간헤더
		const timeHeader = document.createElement('th');
		timeHeader.textContent = '시간';
		headRow.appendChild(timeHeader);
		
		//일정헤더
		const contentHeader = document.createElement('th');
		contentHeader.textContent = '일정';
		headRow.appendChild(contentHeader);
		
		//테이블에 헤더 붙이기
		table.appendChild(headRow);
		
		// 시간별 데이터 행
	
// 		schedule()[currClickedDate]
// 		['15', '16', '17','18', '19', '20', '21', '22']
		schedule(ajax_data).forEach((time, i) => {
		    const row = document.createElement('tr');
		    
		    // 시간 셀 추가
		    const timeCell = document.createElement('td');
		    
		    // 체크박스 생성
		    let timeCheck = document.createElement('input');
		    timeCheck.type = 'button'; // input 요소의 타입을 checkbox로 설정
		    if (!unable.includes(time)){
		    	timeCheck.value = '가능';
		    } else {
		    	timeCheck.value = '불가능';
		    }
		    // timeCheck.onclick = 'impossible'
		    timeCheck.id = `time${i}`; // id 설정 (옵션)
		    timeCheck.addEventListener('click', function(ev){
		    	timeCheck.classList.toggle('change');
				if(timeCheck.value == "가능"){
					timeCheck.value="불가능";
					console.log(timeCheck.parentNode.innerText.substr(0,2));
				} else if (timeCheck.value == "불가능"){
					timeCheck.value="가능";
				}
			});
		    // 시간 셀에 시간 텍스트 추가
		    timeCell.textContent = time;
		    
		    // 체크박스를 시간 셀에 추가
		    timeCell.appendChild(timeCheck);
		    
		    // 시간 셀을 행에 추가
		    row.appendChild(timeCell);
		    
		    // 상태 셀 추가
		    const contentCell = document.createElement('td');
		    contentCell.textContent = '상태';
		    row.appendChild(contentCell);
		    
		    // 행을 테이블에 추가
		    table.appendChild(row);
		});

	    // 기존 내용 초기화 후 테이블을 컨테이너에 추가
	    dayContainer.innerHTML = '';
	    dayContainer.appendChild(table);
	} 
	
	
	const dayBtn = document.getElementById('dayBtn');
	
	dayBtn.addEventListener('click', ()=>{
		let param =[];

		let modalDateValue = $('#modalDate').val();
		console.log('오늘날짜', modalDateValue);

// 		let selectTableRows = selectTable;
		let selectTable = $('#counselDayTime');
		let selectInputs = selectTable.find('.change');
		selectInputs.each((idx, ele) => {
				param.push({ reservationDate : modalDateValue, timeCode : $(ele).parent().text()});
		})
		
// 		console.log('테이블', selectInputs);
// 		for(let i=0; i<selectTableRows; i++){
// 			let posVal = document.getElementById('time' + i).value;
// 			if("불가능" == posVal){
// 	            let rowText = selectTable.rows[i].cells[0].innerText;
// 	            param.push(rowText);
// 			}
// 		}
		
		console.log('시간', param);
		$.ajax({
			type: 'post',
			url: 'counselDayTime', // 데이터를 주고받을 파일 주소 입력
			data: JSON.stringify(param),
			contentType: 'application/json; charset=utf-8',
			dataType: 'json', // JSON 형식으로 받기
			success: function(result){
				console.log('서버 응답:', result);
			},
			error: function(){  
				console.error('서버 요청 실패');
			}
		});
	});
	
	// ===================================================================================
	// ===================================================================================
	// 주 - 상담 시간 설정 =======================================================================================
	const counselModal = new bootstrap.Modal(document.getElementById('weekTime'));
	
	const days = ['월요일', '화요일', '수요일', '목요일', '금요일'];
	const container = document.getElementById('counselWeekTime');

	const data = /*[[${counselTime}]]*/"";

	


	document.addEventListener('DOMContentLoaded', function() {
		updateTimeSetting();
	    console.log('test clg')
	});
	
	function updateTimeSetting(){
		days.forEach((day, idx) => {
			let times = data[idx].timeCode.split(',');
			const dayTimeSetting = document.createElement('div');
			dayTimeSetting.className = 'day-time-setting';
			let opt = `
				<label for="start${idx}">${day}:</label>    
				<select id="start${idx}" name="counselTime" class="form-select" aria-label="${day} 시작 시간">
					<option selected>상담 시작</option>`;
			for(let i=10; i<=22; i++){
				opt += `<option value="${i}" ${ times[0]==i ? 'selected' : ''  }>${i}:00</option>`;
			}  
			opt += `</select>
				<p style="margin: 0 10px;">~</p>
				<select id="end${idx}" class="form-select" aria-label="${day} 마감 시간">
					<option selected>상담 마감</option>`;
			for(let i=10; i<=22; i++){
				opt += `<option value="${i}" ${ times[1] == i ? 'selected' : ''  }>${i}:00</option>`;
			}  
			opt += `</select>`;
			dayTimeSetting.innerHTML = opt;
			container.appendChild(dayTimeSetting);
		});
	} 
		
	const weekBtn = document.getElementById('weekBtn');
	weekBtn.addEventListener('click', ()=>{
		let param =[];
		days.forEach((day, i) => {
			let startTime = document.getElementById(`start${i}`).value
			let endTime = document.getElementById(`end${i}`).value
			param.push({weekdaysCode: day, timeCode: startTime +"," + endTime});
		});
		console.log(param.Timecode);
			
		$.ajax({
			type: 'post',
			url: 'counselWeekTime', // 데이터를 주고받을 파일 주소 입력
			data: JSON.stringify(param),
			contentType: 'application/json; charset=utf-8',
			dataType: 'json', // JSON 형식으로 받기
			success: function(result){
				console.log('서버 응답:', result);
			},
			error: function(){  
				console.error('서버 요청 실패');
			}
		});
	});
    </script>











<!-- 달력복사한거 -->
<!-- FullCalendar Core Stylesheet -->
<script src="/lms/js/calendar/calendar.js"th:inline="javascript">

	</script>


  <!-- FullCalendar Core JavaScript -->
  <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.min.js'></script>

  <!-- FullCalendar Interaction Plugin JavaScript -->
  <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/interaction/main.min.js'></script>

  <!-- FullCalendar DayGrid Plugin JavaScript -->
  <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.min.js'></script>

  <!-- FullCalendar TimeGrid Plugin JavaScript -->
  <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.min.js'></script>

</html>

