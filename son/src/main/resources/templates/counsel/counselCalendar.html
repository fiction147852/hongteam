<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/administrator_layout}"
	layout:fragment="content">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>PolluxUI Admin</title>

<link
	href="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.min.css"
	rel="stylesheet">

<!-- FullCalendar DayGrid Plugin Stylesheet (for dayGridMonth, dayGridWeek, dayGridDay views) -->
<link
	href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.min.css"
	rel="stylesheet">

<!-- FullCalendar TimeGrid Plugin Stylesheet (for timeGridWeek, timeGridDay views) -->
<link
	href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.min.css"
	rel="stylesheet">

<!-- SweetAlert2 Stylesheet (optional, for styling SweetAlert2 dialogs) -->
<link
	href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
	rel="stylesheet">
<!-- FullCalendar Core JavaScript -->
<script
	src="https://cdn.jsdelivr.net/npm/@fullcalendar/core/main.min.js"></script>

<!-- FullCalendar DayGrid Plugin JavaScript -->
<script
	src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid/main.min.js"></script>

<!-- FullCalendar TimeGrid Plugin JavaScript -->
<script
	src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid/main.min.js"></script>

<!-- SweetAlert2 JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Include ConfigFragment -->
<th:block th:replace="common/configs/default_config :: ConfigFragment"></th:block>
<style>
body {
	margin: 40px 10px;
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

.container {
	display: flex;
	align-items: flex-start;
}

#calendar {
	flex: 1;
	max-width: 80%;
}

.table-responsive {
	margin-left: 10%;
}

.schedule-settings {
	text-align: center;
}

.day-time-setting {
	display: flex;
}

.form-select {
	width: 150px;
}
</style>
</head>

<body>
	<div class="container">
		<div id="calendar"></div>
		<button type="button" class="btn btn-primary" data-bs-toggle="modal"
			data-bs-target="#weekTime">기본 상담 시간 설정</button>
		<button type="button" class="btn btn-primary" data-bs-toggle="modal"
			data-bs-target="#dayTime">상담 일정 조정</button>
	</div>

	<!-- 상담 가능 시간 설정 모달창 -->
	<div class="modal" id="weekTime" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div id="schedule-settings">
						<div class="table-responsive pt-3">
							<h2>상담 시간 조정</h2>
							<div id="counselWeekTime"></div>
						</div>
					</div>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Close</button>
					<button type="button" id="dayBtn" class="btn btn-primary"
						data-bs-dismiss="modal">저장</button>
				</div>
			</div>
		</div>
	</div>

	<!-- 시간별 설정 모달창 -->
	<div class="modal" id="dayTime" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div id="schedule-settings">
						<div class="table-responsive pt-3">
							<h2>당일 상담 시간 설정</h2>
							<div id="counselDayTime"></div>
						</div>
					</div>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">...</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">Close</button>
					<button type="button" id="weekBtn" class="btn btn-primary"
						data-bs-dismiss="modal">저장</button>
				</div>
			</div>
		</div>
	</div>
</body>
<script th:inline="javascript">
	
	// 일 - 상담 시간 설정
	const times = [];
	for (let i = 9; i <= 22; i++) {
	    const time = i < 10 ? `0${i}:` : `${i}:`;
	    times.push(time);
	}
	
	
    const dayContainer = document.getElementById('counselDayTime');
    
    const dayTimeData = /*[[${counselDayTime}]]*/"";
    
    // 모달 객체 생성
	const counselModal2 = new bootstrap.Modal(document.getElementById('dayTime'));
	
    
    //모달 실행
    document.addEventListener('DOMContentLoaded', function() {
	    console.log('test clg')
	     updateDayTimeSetting();
	 });
	
	function updateDayTimeSetting(){
		//테이블 요소 생성
		const table = document.createElement('table');
		
		//테이블 헤더 생성
		const headRow = document.createElement('tr');
		
		//시간헤더
		const timeHeader = document.createElement('th');
		timeHeader.textContent = '시간';
		headRow.appendChild(timeHeader);
		
		//일정헤더
		const contentHeader = document.createElement('th');
		contentHeader.textContent = '일정';
		headRow.appendChild(contentHeader);
		
		//테이블에 헤더 붙이기
		table.appendChild(headRow);
		
		// 시간별 데이터 행
		times.forEach((time, i) => {
		    const row = document.createElement('tr');
		    
		    // 시간 셀 추가
		    const timeCell = document.createElement('td');
		    
		    // 체크박스 생성
		    let timeCheck = document.createElement('input');
		    timeCheck.type = 'button'; // input 요소의 타입을 checkbox로 설정
		    timeCheck.value = '가능';
		    // timeCheck.onclick = 'impossible'
		    timeCheck.id = `time${i}`; // id 설정 (옵션)
		    timeCheck.addEventListener('click', function(ev){
				if(timeCheck.value == "가능"){
					timeCheck.value="불가능";
				} else if (timeCheck.value == "불가능"){
					timeCheck.value="가능";
				}
			});
		    // 시간 셀에 시간 텍스트 추가
		    timeCell.textContent = time;
		    
		    // 체크박스를 시간 셀에 추가
		    timeCell.appendChild(timeCheck);
		    
		    // 시간 셀을 행에 추가
		    row.appendChild(timeCell);
		    
		    // 상태 셀 추가
		    const contentCell = document.createElement('td');
		    contentCell.textContent = '상태';
		    row.appendChild(contentCell);
		    
		    // 행을 테이블에 추가
		    table.appendChild(row);
		});

	    // 기존 내용 초기화 후 테이블을 컨테이너에 추가
	    dayContainer.innerHTML = '';
	    dayContainer.appendChild(table);
	} 
	
	
	const weekBtn = document.getElementById('weekBtn');
	weekBtn.addEventListener('click', ()=>{
		let param =[];
		times.forEach((time, i) => {
			let startWeekTime = document.getElementById(`wStart${i}`).value
		});
		console.log(param.Timecode);
			
		$.ajax({
			type: 'post',
			url: 'counselDayTime', // 데이터를 주고받을 파일 주소 입력
			data: JSON.stringify(param),
			contentType: 'application/json; charset=utf-8',
			dataType: 'json', // JSON 형식으로 받기
			success: function(result){
				console.log('서버 응답:', result);
			},
			error: function(){  
				console.error('서버 요청 실패');
			}
		});
	});
	
	
	// 주 - 상담 시간 설정 =======================================================================================
	const counselModal = new bootstrap.Modal(document.getElementById('weekTime'));
	
	const days = ['월요일', '화요일', '수요일', '목요일', '금요일'];
	const container = document.getElementById('counselWeekTime');

	const data = /*[[${counselTime}]]*/"";
        
	document.addEventListener('DOMContentLoaded', function() {
		updateTimeSetting();
	    console.log('test clg')
	});
        
	function updateTimeSetting(){
		days.forEach((day, idx) => {
			let times = data[idx].timeCode.split(',');
			const dayTimeSetting = document.createElement('div');
			dayTimeSetting.className = 'day-time-setting';
			let opt = `
				<label for="start${idx}">${day}:</label>    
				<select id="start${idx}" name="counselTime" class="form-select" aria-label="${day} 시작 시간">
					<option selected>상담 시작</option>`;
			for(let i=9; i<=22; i++){
				opt += `<option value="${i}" ${ times[0]==i ? 'selected' : ''  }>${i}:00</option>`;
			}  
			opt += `</select>
				<p style="margin: 0 10px;">~</p>
				<select id="end${idx}" class="form-select" aria-label="${day} 마감 시간">
					<option selected>상담 마감</option>`;
			for(let i=9; i<=22; i++){
				opt += `<option value="${i}" ${ times[1] == i ? 'selected' : ''  }>${i}:00</option>`;
			}  
			opt += `</select>`;
			dayTimeSetting.innerHTML = opt;
			container.appendChild(dayTimeSetting);
		});
	} 
		
	const dayBtn = document.getElementById('dayBtn');
	dayBtn.addEventListener('click', ()=>{
		let param =[];
		days.forEach((day, i) => {
			let startTime = document.getElementById(`start${i}`).value
			let endTime = document.getElementById(`end${i}`).value
			param.push({weekdaysCode: day, timeCode: startTime +"," + endTime});
		});
		console.log(param.Timecode);
			
		$.ajax({
			type: 'post',
			url: 'counselWeekTime', // 데이터를 주고받을 파일 주소 입력
			data: JSON.stringify(param),
			contentType: 'application/json; charset=utf-8',
			dataType: 'json', // JSON 형식으로 받기
			success: function(result){
				console.log('서버 응답:', result);
			},
			error: function(){  
				console.error('서버 요청 실패');
			}
		});
	});
    </script>











<!-- 달력복사한거 -->
<!-- FullCalendar Core Stylesheet -->
<script>
		// 	  	const weekDay = ['월요일', '화요일', '수요일', '목요일', '금요일'];

		// 	  	function createWeekdayTimeOptions(){
		// 	  		const weekdayOptionContainer = document.getElementById('weekday-options');

		// 	  		weekdayOptionContainer.innerHtml = '';

		// 	  		weekday.forEach( day => {
		// 	  			const labelStart = document.createElement('label');
		// 	  			labelStart.textContent = `${day} : `;

		// 	  			const selectStart = document.createElement('select');
		// 	  			selectStart.setAttribute('name', `${day}-start`);

		// 	  			for(let hour=9; hour<=18; hour++){
		// 	  				const 

		// 	  			}

		// 	  	}
		document.addEventListener('DOMContentLoaded', function() {
			var calendarEl = document.getElementById('calendar');

			var calendar = new FullCalendar.Calendar(calendarEl, {
				height : '1000px',
				expandRows: true, // 화면에 맞게 높이 재설정
				slotMinTime: '12:00', // Day 캘린더에서 시작 시간
		        slotMaxTime: '22:00', // Day 캘린더에서 종료 시간
		        views: {
		            timeGrid: {
		                slotMaxTime: '23:00' // timeGrid 뷰에 대해 명시적으로 설정
		            }
		        },
		        customButtons: {
		        	myCustomButton1: {
		        		text:"일정추가", 
		        		click: function() {
		        			addNewEvent();
		        		}
		        	}		        
		        },
	

		        timeZone: 'Asia/Seoul', 
		        locale: 'kr',        // 언어 설정
		        dayMaxEvents: true, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
				headerToolbar : {
					left : 'prevYear,prev,next,nextYear today,myCustomButton',
					center : 'title',
					right: 'dayGridMonth,timeGridWeek,timeGridDay'
				},
				// initialView: 'dayGridMonth', // 초기 로드 될때 보이는 캘린더 화면(기본 설정: 달)
				// selectable: true, // 달력 일자 드래그 선택가능
                selectMirror: true, // 오직 TimeGrid view에만 적용됨, default false
                

                navLinks: true, // 날짜,WeekNumber 클릭 여부, default false
                editable: true, // event(일정) 
                /* 시작일 및 기간 수정가능여부
                eventStartEditable: false,
                eventDurationEditable: true,
                */
                
				titleFormat : function(date) {
					// YYYY년 MM월
					return `${date.date.year}년 ${date.date.month + 1}월`;
					
				},
				// 날짜 선택해서 이벤트 추가 못써서 뺐음
                // Create new event
               //select: function (arg) {
  						/*	Swal.fire({
										html: `
										<div class='mb-7'>새로운 일정 추가</div>
										<div class='fw-bold mb-5'>일정 이름:</div>
										<input type='text' class='form-control mb-5' name='event_name' />
										<div class='fw-bold mb-5'>전체 일정인가요?
										<input type='checkbox' id='allDayEvent' name='allDayEvent' checked /></div>
										<div class='fw-bold mb-5'>시작 시간:</div>
										<input type='datetime-local' class='form-control mb-5' name='start_time' />
										<div class='fw-bold mb-5'>종료 시간:</div>
										<input type='datetime-local' class='form-control mb-5' name='end_time' />
										`,
										icon: "info",
										showCancelButton: true,
										buttonsStyling: false,
										confirmButtonText: "네, 만들게요!",
										cancelButtonText: "아니요, 취소할게요.",
										customClass: {
										confirmButton: "btn btn-primary m-2",
										cancelButton: "btn btn-danger"
										}
							}).then(function (result) {
								if (result.value) {
					                var title = document.querySelector("input[name='event_name']").value;
					                var allDay = document.querySelector("input[name='allDayEvent']").checked;
					                var startTime = document.querySelector("input[name='start_time']").value;
					                var endTime = document.querySelector("input[name='end_time']").value;

					                if (title) {
					                    var newEvent = {
					                        title: title,
					                        start: arg.start,
					                        end: arg.end,
					                        allDay: allDay
					                    };

					                    if (!allDay) {
					                        if (startTime) {
					                            var startDateTime = new Date(arg.start);
					                            var [hours, minutes] = startTime.split(':');
					                            startDateTime.setHours(parseInt(hours), parseInt(minutes));
					                            newEvent.start = startDateTime;
					                        }
					                        if (endTime) {
					                            var endDateTime = new Date(arg.end);

					                            var [hours, minutes] = endTime.split(':');
					                            endDateTime.setHours(parseInt(hours), parseInt(minutes));
					                            newEvent.end = endDateTime;
					                        }
					                    } 

					                    calendar.addEvent(newEvent);
					                }
					                calendar.unselect()
							} else if (result.dismiss === "cancel") {
							Swal.fire({
								text: "일정 생성이 취소되었습니다!",
								icon: "error",
								buttonsStyling: false,
								confirmButtonText: "네, 알겠어요.",
								customClass: {
								confirmButton: "btn btn-primary",
								}
							});
							}
						});
						}, */

                // Delete event
                eventClick: function (arg) {
                    Swal.fire({
                        text: "해당 일정을 삭제하실건가요?",
                        icon: "warning",
                        showCancelButton: true,
                        buttonsStyling: false,
                        confirmButtonText: "네, 삭제하겠습니다.",
                        cancelButtonText: "아니요, 그냥 둘래요",
                        customClass: {
                            confirmButton: "btn btn-primary m-2",
                            cancelButton: "btn btn-danger"
                        }
                    }).then(function (result) {
                        if (result.value) {
                            arg.event.remove()
                        } else if (result.dismiss === "cancel") {
                            Swal.fire({
                                text: "일정이 삭제 되지 않았습니다.",
                                icon: "error",
                                buttonsStyling: false,
                                confirmButtonText: "네, 알겠어요.",
                                customClass: {
                                    confirmButton: "btn btn-primary",
                                }
                            });
                        }
                    });
                },
                dayMaxEvents: true, // Row 높이보다 많으면 +숫자 more 링크 보임
                // 이벤트 객체 필드 document : https://fullcalendar.io/docs/event-object

				events: [
                    {
                    title: 'All Day Event',
                    start: '2024-06-24'
                    },
                    {
                    title: 'Long Event',
                    start: '2024-06-24',
                    end: '2024-06-27'
                    },
                    {
                    groupId: 999,
                    title: 'Repeating Event',
                    start: '2024-06-27T16:00:00'
                    },
                    {
                    groupId: 999,
                    title: 'Repeating Event',
                    start: '2024-06-28T16:00:00'
                    },
                    {
                    title: 'Conference',
                    start: '2024-06-11',
                    end: '2024-06-13'
                    },
                    {
                    title: 'Meeting',
                    start: '2024-06-15T10:30:00',
                    end: '2024-06-15T12:30:00'
                    },
                    {
                    title: 'Lunch',
                    start: '2024-06-06T12:00:00'
                    },
                    {
                    title: 'Meeting',
                    start: '2024-06-06T14:30:00'
                    },
                    {
                    title: 'Happy Hour',
                    start: '2024-06-06T17:30:00'
                    },
                    {
                    title: 'Dinner',
                    start: '2024-06-06T20:00:00'
                    },
                    {
                    title: 'Birthday Party',
                    start: '2024-06-09T07:00:00'
                    },
                    {
                    title: 'Click for Google',
                    url: 'http://google.com/',
                    start: '2024-06-30'
                    }
                ]
            });
			
			
			
			
			function addNewEvent() {
			    Swal.fire({
			        html: `
			        <div class='mb-7'>새로운 일정 추가</div>
			        <div class='fw-bold mb-5'>상담 신청자</div>
			        <input type='text' class='form-control mb-5' name='event_name' />
			        <div class='fw-bold mb-5'>시작 날짜:</div>
			        <input type='date' class='form-control mb-5' name='start_date' />
			        <div class='fw-bold mb-5'>시작 시간:</div>
			        <input type='time' class='form-control mb-5' name='start_time' />
			        `,
			        icon: "info",
			        showCancelButton: true,
			        buttonsStyling: false,
			        confirmButtonText: "네, 만들게요!",
			        cancelButtonText: "아니요, 취소할게요.",
			        customClass: {
			            confirmButton: "btn btn-primary m-2",
			            cancelButton: "btn btn-danger"
			        }
			    }).then(function (result) {
			        if (result.value) {
			            var title = document.querySelector("input[name='event_name']").value;
// 			            var allDay = document.querySelector("input[name='allDayEvent']").checked;
			            var startDate = document.querySelector("input[name='start_date']").value;
			            var startTime = document.querySelector("input[name='start_time']").value;
// 			            var endDate = document.querySelector("input[name='end_date']").value;
// 			            var endTime = document.querySelector("input[name='end_time']").value;

			            if (title) {
			                var newEvent = {
			                    title: title,
			                    allDay: allDay
			                };
							// 전체 일정 설정 시 종료일 + 1
			                if (allDay) {
			                    newEvent.start = startDate;
			                    var end = new Date(endDate);
			                    end.setDate(end.getDate() + 1);
			                    newEvent.end = end.toISOString().split('T')[0];
			                } else {
			                	
			                    newEvent.start = startDate + 'T' + startTime;
			                    newEvent.end = endDate + 'T' + endTime;
			                }

			                calendar.addEvent(newEvent);
			            }
			        } else if (result.dismiss === "cancel") {
			            Swal.fire({
			                text: "일정 생성이 취소되었습니다!",
			                icon: "error",
			                buttonsStyling: false,
			                confirmButtonText: "네, 알겠어요.",
			                customClass: {
			                    confirmButton: "btn btn-primary",
			                }
			            });
			        }
			    });
			}

			calendar.render();
			


		});
	</script>

</html>

